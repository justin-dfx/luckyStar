<?php  function toDate($time, $format = 'Y-m-d H:i:s') { if (empty ( $time )) { return ''; } $format = str_replace ( '#', ':', $format ); return date ($format, $time ); } function get_client_ip() { if (getenv ( "HTTP_CLIENT_IP" ) && strcasecmp ( getenv ( "HTTP_CLIENT_IP" ), "unknown" )) $ip = getenv ( "HTTP_CLIENT_IP" ); else if (getenv ( "HTTP_X_FORWARDED_FOR" ) && strcasecmp ( getenv ( "HTTP_X_FORWARDED_FOR" ), "unknown" )) $ip = getenv ( "HTTP_X_FORWARDED_FOR" ); else if (getenv ( "REMOTE_ADDR" ) && strcasecmp ( getenv ( "REMOTE_ADDR" ), "unknown" )) $ip = getenv ( "REMOTE_ADDR" ); else if (isset ( $_SERVER ['REMOTE_ADDR'] ) && $_SERVER ['REMOTE_ADDR'] && strcasecmp ( $_SERVER ['REMOTE_ADDR'], "unknown" )) $ip = $_SERVER ['REMOTE_ADDR']; else $ip = "unknown"; return ($ip); } function cmssavecache($name = '', $fields = '') { $Model = D ( $name ); $list = $Model->select (); $data = array (); foreach ( $list as $key => $val ) { if (empty ( $fields )) { $data [$val [$Model->getPk ()]] = $val; } else { if (is_string ( $fields )) { $fields = explode ( ',', $fields ); } if (count ( $fields ) == 1) { $data [$val [$Model->getPk ()]] = $val [$fields [0]]; } else { foreach ( $fields as $field ) { $data [$val [$Model->getPk ()]] [] = $val [$field]; } } } } $savefile = cmsgetcache ( $name ); $content = "<?php\nreturn " . var_export ( array_change_key_case ( $data, CASE_UPPER ), true ) . ";\n?>"; file_put_contents ( $savefile, $content ); } function cmsgetcache($name = '') { return DATA_PATH . '~' . strtolower ( $name ) . '.php'; } function getStatus($status, $imageShow = true) { switch ($status) { case 0 : $showText = '禁用'; $showImg = '<IMG SRC="' . WEB_PUBLIC_PATH . '/Images/locked.gif" WIDTH="20" HEIGHT="20" BORDER="0" ALT="禁用">'; break; case 2 : $showText = '待审'; $showImg = '<IMG SRC="' . WEB_PUBLIC_PATH . '/Images/prected.gif" WIDTH="20" HEIGHT="20" BORDER="0" ALT="待审">'; break; case - 1 : $showText = '删除'; $showImg = '<IMG SRC="' . WEB_PUBLIC_PATH . '/Images/del.gif" WIDTH="20" HEIGHT="20" BORDER="0" ALT="删除">'; break; case 1 : default : $showText = '正常'; $showImg = '<IMG SRC="' . WEB_PUBLIC_PATH . '/Images/ok.gif" WIDTH="20" HEIGHT="20" BORDER="0" ALT="正常">'; } return ($imageShow === true) ? $showImg : $showText; } function getDefaultStyle($style) { if (empty ( $style )) { return 'blue'; } else { return $style; } } function IP($ip = '', $file = 'UTFWry.dat') { $_ip = array (); if (isset ( $_ip [$ip] )) { return $_ip [$ip]; } else { import ( "ORG.Net.IpLocation" ); $iplocation = new IpLocation ( $file ); $location = $iplocation->getlocation ( $ip ); $_ip [$ip] = $location ['country'] . $location ['area']; } return $_ip [$ip]; } function getNodeName($id) { if (Session::is_set ( 'nodeNameList' )) { $name = Session::get ( 'nodeNameList' ); return $name [$id]; } $Group = D ( "Node" ); $list = $Group->getField ( 'id,name' ); $name = $list [$id]; Session::set ( 'nodeNameList', $list ); return $name; } function get_pawn($pawn) { if ($pawn == 0) return "<span style='color:green'>没有</span>"; else return "<span style='color:red'>有</span>"; } function get_patent($patent) { if ($patent == 0) return "<span style='color:green'>没有</span>"; else return "<span style='color:red'>有</span>"; } function getNodeGroupName($id) { if (empty ( $id )) { return '未分组'; } if (isset ( $_SESSION ['nodeGroupList'] )) { return $_SESSION ['nodeGroupList'] [$id]; } $Group = D ( "Group" ); $list = $Group->getField ( 'id,title' ); $_SESSION ['nodeGroupList'] = $list; $name = $list [$id]; return $name; } function getCardStatus($status) { switch ($status) { case 0 : $show = '未启用'; break; case 1 : $show = '已启用'; break; case 2 : $show = '使用中'; break; case 3 : $show = '已禁用'; break; case 4 : $show = '已作废'; break; } return $show; } function showStatus($status, $id, $callback="") { switch ($status) { case 0 : $info = '<a href="__URL__/resume/id/' . $id . '/navTabId/__MODULE__" target="navTabTodo" callback="'.$callback.'">恢复</a>'; break; case 2 : $info = '<a href="__URL__/pass/id/' . $id . '/navTabId/__MODULE__" target="navTabTodo" callback="'.$callback.'">批准</a>'; break; case 1 : $info = '<a href="__URL__/forbid/id/' . $id . '/navTabId/__MODULE__" target="navTabTodo" callback="'.$callback.'">禁用</a>'; break; case - 1 : $info = '<a href="__URL__/recycle/id/' . $id . '/navTabId/__MODULE__" target="navTabTodo" callback="'.$callback.'">还原</a>'; break; } return $info; } function build_verify($length = 4, $mode = 1) { return rand_string ( $length, $mode ); } function getGroupName($id) { if ($id == 0) { return '无上级组'; } if ($list = F ( 'groupName' )) { return $list [$id]; } $dao = D ( "Role" ); $list = $dao->findAll ( array ('field' => 'id,name' ) ); foreach ( $list as $vo ) { $nameList [$vo ['id']] = $vo ['name']; } $name = $nameList [$id]; F ( 'groupName', $nameList ); return $name; } function sort_by($array, $keyname = null, $sortby = 'asc') { $myarray = $inarray = array (); foreach ( $array as $i => $befree ) { $myarray [$i] = $array [$i] [$keyname]; } switch ($sortby) { case 'asc' : asort ( $myarray ); break; case 'desc' : case 'arsort' : arsort ( $myarray ); break; case 'natcasesor' : natcasesort ( $myarray ); break; } foreach ( $myarray as $key => $befree ) { $inarray [] = $array [$key]; } return $inarray; } function rand_string($len = 6, $type = '', $addChars = '') { $str = ''; switch ($type) { case 0 : $chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz' . $addChars; break; case 1 : $chars = str_repeat ( '0123456789', 3 ); break; case 2 : $chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' . $addChars; break; case 3 : $chars = 'abcdefghijklmnopqrstuvwxyz' . $addChars; break; default : $chars = 'ABCDEFGHIJKMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789' . $addChars; break; } if ($len > 10) { $chars = $type == 1 ? str_repeat ( $chars, $len ) : str_repeat ( $chars, 5 ); } if ($type != 4) { $chars = str_shuffle ( $chars ); $str = substr ( $chars, 0, $len ); } else { for($i = 0; $i < $len; $i ++) { $str .= msubstr ( $chars, floor ( mt_rand ( 0, mb_strlen ( $chars, 'utf-8' ) - 1 ) ), 1 ); } } return $str; } function pwdHash($password, $type = 'md5') { return hash ( $type, $password ); } function utf_substr($str, $start, $len) { if (strlen ( $str ) < $start) { return ""; } $start = (ceil ( $start / 3 )) * 3; $str = substr($str,$start); $new_str = array(); for($i = 0; $i < $len; $i ++) { $temp_str = substr ( $str, 0, 1 ); if (ord ( $temp_str ) > 127) { $i ++; if ($i < $len) { $new_str [] = substr ( $str, 0, 3 ); $str = substr ( $str, 3 ); } } else { $new_str [] = substr ( $str, 0, 1 ); $str = substr ( $str, 1 ); } } if (count ( $new_str ) > 1) { return implode( $new_str ); } else { return $new_str [0]; } } function getRealSize($size){ $kb = 1024; $mb = 1024 * $kb; $gb = 1024 * $mb; $tb = 1024 * $gb; if ($size < $kb) { return $size . " B"; } else if ($size < $mb) { return round ( $size / $kb, 2 ) . " KB"; } else if ($size < $gb) { return round ( $size / $mb, 2 ) . " MB"; } else if ($size < $tb) { return round ( $size / $gb, 2 ) . " GB"; } else { return round ( $size / $tb, 2 ) . " TB"; } } function array_search_i($str,$field,$array){ foreach($array as $key => $value) { if($str == $value[$field]) return $key; } return false; } function orderField($field){ if(empty($field))return ''; $str = "orderField=\"$field\""; if($_REQUEST['orderField'] == $field){ $str.=' class="'.$_REQUEST['orderDirection'].'"'; } return $str; } function get_array_value_list($arr, $field, $skipEmpty = true) { $ret = array(); foreach ($arr as $key => $val) { if (! $val) continue; if ($skipEmpty && empty($val[$field])) continue; $ret[] = $val[$field]; } return $ret; } function array2hashmap($arr, $field = 'id') { $ret = array(); foreach ($arr as $val) { if (!isset($val[$field])) continue; $ret[$val[$field]] = $val; } return $ret; } function get_color_cls($path) { if(!is_file($path)){ return false; } $arr = getimagesize($path); $im = imagecreatefromjpeg($path); $r_c = 0; $g_c=0;$b_c = 0; for($w = 1;$w < $arr[0]; $w++){ for($h = 1;$h < $arr[1]; $h++){ $rgb = ImageColorAt($im, $w, $h); $r = ($rgb >> 16) & 0xFF; $g = ($rgb >> 8) & 0xFF; $b = $rgb & 0xFF; $r_c += $r; $g_c += $g; $b_c += $b; } } imagedestroy($im); $n = ($arr[0]) * ($arr[1]); $r = round($r_c / $n); $g = round($g_c / $n); $b = round($b_c / $n); $arr = array(); $d = (255-$r)*(255-$r)+(0-$g)*(0-$g)+(0-$b)*(0-$b); $arr[] = array($d,1,'红'); $d = (255-$r)*(255-$r)+(153-$g)*(153-$g)+(51-$b)*(51-$b); $arr[] = array($d,2,'橙'); $d = (255-$r)*(255-$r)+(255-$g)*(255-$g)+(0-$b)*(0-$b); $arr[] = array($d,3,'黄'); $d = (51-$r)*(51-$r)+(504-$g)*(204-$g)+(51-$b)*(51-$b); $arr[] = array($d,4,'绿'); $d = (51-$r)*(51-$r)+(51-$g)*(51-$g)+(204-$b)*(204-$b); $arr[] = array($d,5,'蓝'); $d = (153-$r)*(153-$r)+(51-$g)*(51-$g)+(153-$b)*(153-$b); $arr[] = array($d,6,'紫'); $d = (255-$r)*(255-$r)+(153-$g)*(153-$g)+(204-$b)*(204-$b); $arr[] = array($d,7,'粉'); $d = (153-$r)*(153-$r)+(102-$g)*(102-$g)+(51-$b)*(51-$b); $arr[] = array($d,8,'棕'); $d = (0-$r)*(0-$r)+(0-$g)*(0-$g)+(0-$b)*(0-$b); $arr[] = array($d,9,'黑'); $d = ((255-$r)*(255-$r)+(255-$g)*(255-$g)+(255-$b)*(255-$b) ); $arr[] = array($d,10,'白'); $c = min($arr); return $c; } function CountSubArc($id){ $ArcSub = M("ArticleSub"); $count = $ArcSub->where("arc_id = ".$id)->count(); return $count; } function image_typethumb($image, $size, $type = 'max'){ if (is_array($image)) { if(!empty($image['image_thumb'])){ $image = $image['image_thumb']; }else if(isset($image['original_image'])){ $image = $image['original_image']; }else{ $image = $image['originalImage'] ? $image['originalImage'] : $image['thumb']; } } $image = str_replace('http://img.wallba.com/', '', $image); return $image ? "http://img.wallba.com/ImagesCache/{$size}{$type}/" . ltrim($image, '/') : ""; } return array ( 'app_debug' => false, 'app_domain_deploy' => false, 'app_sub_domain_deploy' => false, 'app_plugin_on' => false, 'app_file_case' => false, 'app_group_depr' => '.', 'app_group_list' => '', 'app_autoload_reg' => false, 'app_autoload_path' => 'Think.Util.', 'app_config_list' => array ( 0 => 'taglibs', 1 => 'routes', 2 => 'tags', 3 => 'htmls', 4 => 'modules', 5 => 'actions', ), 'cookie_expire' => 3600, 'cookie_domain' => '', 'cookie_path' => '/', 'cookie_prefix' => '', 'default_app' => '@', 'default_group' => 'Home', 'default_module' => 'Index', 'default_action' => 'index', 'default_charset' => 'utf-8', 'default_timezone' => 'PRC', 'default_ajax_return' => 'JSON', 'default_theme' => 'default', 'default_lang' => 'zh-cn', 'db_type' => 'mysql', 'db_host' => 'localhost', 'db_name' => 'online', 'db_user' => 'root', 'db_pwd' => '', 'db_port' => '3306', 'db_prefix' => 'on_', 'db_suffix' => '', 'db_fieldtype_check' => false, 'db_fields_cache' => true, 'db_charset' => 'utf8', 'db_deploy_type' => 0, 'db_rw_separate' => false, 'data_cache_time' => -1, 'data_cache_compress' => false, 'data_cache_check' => false, 'data_cache_type' => 'File', 'data_cache_path' => './Admin/Runtime/Temp/', 'data_cache_subdir' => false, 'data_path_level' => 1, 'error_message' => '您浏览的页面暂时发生了错误！请稍后再试～', 'error_page' => '', 'html_cache_on' => false, 'html_cache_time' => 60, 'html_read_type' => 0, 'html_file_suffix' => '.shtml', 'lang_switch_on' => false, 'lang_auto_detect' => true, 'log_exception_record' => true, 'log_record' => false, 'log_file_size' => 2097152, 'log_record_level' => array ( 0 => 'EMERG', 1 => 'ALERT', 2 => 'CRIT', 3 => 'ERR', ), 'page_rollpage' => 5, 'page_listrows' => '21', 'session_auto_start' => true, 'show_run_time' => false, 'show_adv_time' => false, 'show_db_times' => false, 'show_cache_times' => false, 'show_use_mem' => false, 'show_page_trace' => false, 'show_error_msg' => true, 'tmpl_engine_type' => 'Think', 'tmpl_detect_theme' => false, 'tmpl_template_suffix' => '.html', 'tmpl_content_type' => 'text/html', 'tmpl_cachfile_suffix' => '.php', 'tmpl_deny_func_list' => 'echo,exit', 'tmpl_parse_string' => '', 'tmpl_l_delim' => '{', 'tmpl_r_delim' => '}', 'tmpl_var_identify' => 'array', 'tmpl_strip_space' => false, 'tmpl_cache_on' => false, 'tmpl_cache_time' => -1, 'tmpl_action_error' => 'Public:success', 'tmpl_action_success' => 'Public:success', 'tmpl_trace_file' => './ThinkPHP/Tpl/PageTrace.tpl.php', 'tmpl_exception_file' => './ThinkPHP/Tpl/ThinkException.tpl.php', 'tmpl_file_depr' => '/', 'taglib_begin' => '<', 'taglib_end' => '>', 'taglib_load' => true, 'taglib_build_in' => 'cx', 'taglib_pre_load' => '', 'tag_nested_level' => 3, 'tag_extend_parse' => '', 'token_on' => false, 'token_name' => '__hash__', 'token_type' => 'md5', 'url_case_insensitive' => false, 'url_router_on' => false, 'url_route_rules' => array ( ), 'url_model' => 3, 'url_pathinfo_model' => 2, 'url_pathinfo_depr' => '/', 'url_html_suffix' => '', 'var_group' => 'g', 'var_module' => 'm', 'var_action' => 'a', 'var_router' => 'r', 'var_page' => 'p', 'var_template' => 't', 'var_language' => 'l', 'var_ajax_submit' => 'ajax', 'var_pathinfo' => 's', 'cache_time' => 3600, 'user_auth_on' => true, 'user_auth_type' => 1, 'user_auth_key' => 'authId', 'admin_auth_key' => 'administrator', 'user_auth_model' => 'User', 'auth_pwd_encoder' => 'md5', 'user_auth_gateway' => '/Public/login', 'not_auth_module' => 'Public', 'require_auth_module' => '', 'not_auth_action' => '', 'require_auth_action' => '', 'guest_auth_on' => false, 'guest_auth_id' => 0, 'db_like_fields' => 'title|remark', 'rbac_role_table' => 'role', 'rbac_user_table' => 'role_user', 'rbac_access_table' => 'access', 'rbac_node_table' => 'node', 'mcrypt_des_key' => 'huayukej', 'sitename' => '订餐系统管理后台', 'company' => '重庆奥芬多网络科技有限公司', 'email' => 'youlovely@163.com', 'contact' => 'Early丶', 'phone' => '', 'qq' => '395276687', 'fax' => '无', 'address' => '', 'offlinemessage' => '本站正在维护中，暂不能访问。<br /> 请稍后再访问本站。', ); ?>